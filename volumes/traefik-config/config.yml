api:
  insecure: true

log:
  level: DEBUG
  filePath: /logs/traefik.log

accesslog:
  filePath: /logs/access.log

providers:
  docker:
    exposedByDefault: false
    swarmMode: true

docker:
  network:
    - VCC_stack_default

entryPoints:
  web:
    address: :80
    http:
      redirections:
        entryPoint:
          to: websecure
    forwardedHeaders:
      insecure: true      
  websecure:
    address: :443    

http:
  routers:
    nextcloud_route:
      entryPoints:
        - websecure
      rule: Host(`cloud.localdomain`)
      service: VCC_stack_nextcloud
      tls: true
      middlewares:
        - nextcloud_proto
  middlewares:
    nextcloud_proto:
      headers:
        customrequestheaders:
          X-Forwarded-Proto: https
  services:
    VCC_stack_nextcloud:
      loadbalancer:
        server:
          port: 80
          scheme: https

tls:
  stores:
    default:
      defaultCertificate:
        certFile: /etc/ssl/traefik/server.crt
        keyFile: /etc/ssl/traefik/server.key
  certificates:
    - certFile: /etc/ssl/traefik/server.crt
      keyFile: /etc/ssl/traefik/server.key